---
layout: post
title: CoffeeShop Application
date: 2015-06-02 21:44:14
categories: Java
published: true
---


This is a Demo coffee shop Application using best of breed technologies as in MongoDB from NOSQL world,Angular JS from front end world and Spring from Java framework world.

### Scope of this application

1. Find the  coffee shop nearest to the user's location.
2. Place an order of different varities of coffee in that particular coffeshop
3. Guide the user to pick up the coffee from that coffeeshop by showing the location of that coffeeshop in google maps.



### Technologies Used

**spring Boot** 

I have used spring boot to quickly bootstrap the spring application.Spring boot comes with opinionated view of the Spring platform and third-party libraries so you can get started with minimum fuss.It embeds tomcat/jetty into the application  and deploys the fat jar generated by spring boot maven plugin containing all the application code and required dependencies so that we don't need an application server to be configured outside.The application uses java config for spring related bean configuration and does not have any xml other than pom.xml and its deployable in any PASS like cloud foundry or heroku without any major changes. 

**Spring Batch** 

Spring batch has been used to load information into MongoDB,about starbucks coffeeshops located accross the world from a csv file downloaded from [starbucks location data](https://opendata.socrata.com/Business/All-Starbucks-Locations-in-the-World-Heat-Map/nt5z-pju4).Information includes store id ,storename,street,latitude,longitude etc.

**MongoDB**

Since the application requires search based on geolocation MongoDB fits very well because it inharently supports geo special index.Also  placing an order would create an artifact which correctly fits into a document structure.

**Angular JS and Twitter Bootstrap**

The frontend of this app is developed with Angular JS where I have used $resource module to interact with backend controller developed using spring MVC rest.

Here is how I have used resource module of Angular JS to call a rest backend:

{% highlight JavaScript %}
coffeeApp.factory('CoffeeShopLocator', function ($resource) {
    return $resource('/coffeeshop/nearest',
        {latitude: '@latitude', longitude: '@longitude'}, {});
});

coffeeApp.controller('CoffeeShopController', function ($scope, $window, CoffeeShopLocator) {
    $scope.findCoffeeShopNearestToMe = function () {
        window.navigator.geolocation.getCurrentPosition(function (position) {
            $scope.getCoffeeShopAt(position.coords.latitude, position.coords.longitude)
        }, null);
    };
    $scope.getCoffeeShopAt = function (latitude, longitude) {
        CoffeeShopLocator.get({latitude: latitude, longitude: longitude}).$promise
            .then(
            function (value) {
                $scope.nearestCoffeeShop = value;
            })
            .catch(
            function (value) {
                //default coffee shop
                $scope.getCoffeeShopAt(12.9350891,77.6134262);
            });
    };
});
{% endhighlight %}

**Spring Data MongoDB**

Spring data mongodb provided template based abstraction for the data layer and made it simpler to query mongodb with GeoJSON just by using derived query mechanism of spring data.Latest spring data mongoDB version 1.7 supports GeoJSON.Refer to [MongoDB GeoJSON](http://docs.mongodb.org/manual/reference/geojson/)

**Spring MVC REST**

Here is how I have used MVC controller to handle the request to the rest endpoint from the angular JS UI.This controller makes a call to a method in CoffeeRepository to get the nearest coffeeshop from mongoDB using geo special indexing.The actual query is derived by spring data mongodb at runtime.

{% highlight java %}
@RequestMapping(value = "nearest", method = RequestMethod.GET)
	public Object getNearest(@RequestParam("latitude") double latitude,@RequestParam("longitude") double longitude) throws Exception{
		Point point = new Point(longitude,latitude);
		CoffeeShop  coffeeShop=coffeeshoprepo.findByAddressLocationNear(point);
		return coffeeShop;
	}
{% endhighlight %}

The code for this app is available in a github repo [https://github.com/arghya88/CafelitoSpring](https://github.com/arghya88/CafelitoSpring)




